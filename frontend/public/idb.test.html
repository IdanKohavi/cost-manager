<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>idb.js Test</title>
</head>
<body>
  <h1>idb.js Manual Test</h1>
  <script src="../idb.js"></script>
  <script>
    (async function() {
      const db = await idb.openCostsDB("costsdb", 1);
      const r1 = await db.addCost({ sum: 200, currency: "USD", category: "FOOD", description: "Pizza" });
      const r2 = await db.addCost({ sum: 400, currency: "USD", category: "CAR", description: "Fuel" });
      console.log('added:', r1, r2);
      // put some dummy rates to settings so getReport can convert
      const req = indexedDB.open('costsdb', 1);
      req.onsuccess = () => {
        const _db = req.result;
        const tx = _db.transaction('settings','readwrite');
        tx.objectStore('settings').put({ key: 'rates', value: { USD: 1, GBP: 1.8, EURO: 0.7, ILS: 3.4 } });
        tx.oncomplete = async () => {
          const rep = await db.getReport(new Date().getFullYear(), new Date().getMonth()+1, "USD");
          console.log('report:', rep);
        }
      }
    })();
  </script>
</body>
</html>
